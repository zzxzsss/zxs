--- skid if u want idc the fucking shit isnt even working
-- Services
local Players = game:GetService("Players")
local UserInputService = game:GetService("UserInputService")
local TweenService = game:GetService("TweenService")
local HttpService = game:GetService("HttpService")

-- Configuration
local Player = Players.LocalPlayer
local Identifier = "zzzhub2"
local UserID_HWID = Player.UserId

-- Script URLs
local regularScriptUrl = "https://raw.githubusercontent.com/zzxzsss/zxs/refs/heads/main/main/main.lua"
local premiumScriptUrl = "https://raw.githubusercontent.com/zzxzsss/zxs/refs/heads/main/premium/premium.lua" -- TODO: Replace with your actual premium script URL

-- UI Variables
local screenGui, mainFrame, keyInput, statusLabel

-- Validation function
local function validateKey(key, serviceId, hwid)
    if not key or key == "" then
        return false, "Please enter a key", false
    end

    local validationUrl = "https://pandadevelopment.net/v2_validation?key=" .. HttpService:UrlEncode(tostring(key)) .. "&service=" .. HttpService:UrlEncode(tostring(serviceId)) .. "&hwid=" .. HttpService:UrlEncode(tostring(hwid))

    local success, response = pcall(function()
        return HttpService:RequestAsync({
            Url = validationUrl,
            Method = "GET",
            Headers = {
                ["User-Agent"] = "Roblox/ZZZHub"
            }
        })
    end)

    if not success then
        return false, "Network error occurred", false
    end

    if not response then
        return false, "No response from server", false
    end

    if response.StatusCode ~= 200 then
        return false, "Server error (Code: " .. tostring(response.StatusCode) .. ")", false
    end

    local success2, jsonData = pcall(function()
        return HttpService:JSONDecode(response.Body)
    end)

    if not success2 then
        return false, "Invalid server response", false
    end

    if not jsonData then
        return false, "Empty server response", false
    end

    -- Check authentication status
    if jsonData.V2_Authentication == "success" then
        local isPremium = jsonData.is_premium == true
        local expiresOn = jsonData.expires_on or "Unknown"
        local keyValue = jsonData.key_value or key
        
        local message = isPremium and "Premium key verified! Expires: " .. expiresOn or "Key verified! Expires: " .. expiresOn
        return true, message, isPremium
    elseif jsonData.V2_Authentication == "failed" or jsonData.V2_Authentication == "invalid_key" then
        local reason = jsonData.reason or "Invalid key provided"
        return false, reason, false
    elseif jsonData.V2_Authentication == "expired" then
        return false, "Key has expired", false
    else
        local reason = jsonData.reason or jsonData.message or "Authentication failed"
        return false, reason, false
    end
end

-- Get key link
local function getKeyLink(serviceId, hwid)
    return "https://pandadevelopment.net/getkey?service=" .. HttpService:UrlEncode(tostring(serviceId)) .. "&hwid=" .. HttpService:UrlEncode(tostring(hwid))
end

-- Copy to clipboard
local function copyToClipboard(text)
    if setclipboard then
        setclipboard(text)
        return true
    elseif toclipboard then
        toclipboard(text)
        return true
    end
    return false
end

-- Update status
local function updateStatus(text, color)
    if statusLabel then
        statusLabel.Text = text
        statusLabel.TextColor3 = color or Color3.fromRGB(255, 255, 255)
    end
end

-- Create modern self-contained UI
local function createUI()
    -- Screen GUI
    screenGui = Instance.new("ScreenGui")
    screenGui.Name = "ZZZHubKeySystem"
    screenGui.Parent = Player:WaitForChild("PlayerGui")
    screenGui.ResetOnSpawn = false

    -- Main container
    mainFrame = Instance.new("Frame")
    mainFrame.Name = "MainContainer"
    mainFrame.Parent = screenGui
    mainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
    mainFrame.BackgroundColor3 = Color3.fromRGB(38, 38, 38)
    mainFrame.BorderSizePixel = 0
    mainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
    mainFrame.Size = UDim2.new(0, 400, 0, 450)

    -- Corner radius
    local corner = Instance.new("UICorner")
    corner.CornerRadius = UDim.new(0, 12)
    corner.Parent = mainFrame

    -- Border stroke
    local stroke = Instance.new("UIStroke")
    stroke.Color = Color3.fromRGB(43, 177, 255)
    stroke.Thickness = 3
    stroke.Transparency = 0.2
    stroke.Parent = mainFrame

    -- Title
    local title = Instance.new("TextLabel")
    title.Name = "Title"
    title.Parent = mainFrame
    title.BackgroundTransparency = 1
    title.Position = UDim2.new(0, 20, 0, 5)
    title.Size = UDim2.new(1, -100, 0, 40)
    title.Font = Enum.Font.RobotoCondensed
    title.Text = "Welcome to ZZZ HUB"
    title.TextColor3 = Color3.fromRGB(255, 255, 255)
    title.TextSize = 24
    title.TextXAlignment = Enum.TextXAlignment.Left

    -- Close button
    local closeBtn = Instance.new("TextButton")
    closeBtn.Name = "CloseButton"
    closeBtn.Parent = mainFrame
    closeBtn.BackgroundColor3 = Color3.fromRGB(255, 59, 48)
    closeBtn.BorderSizePixel = 0
    closeBtn.Position = UDim2.new(1, -35, 0, 10)
    closeBtn.Size = UDim2.new(0, 25, 0, 25)
    closeBtn.Font = Enum.Font.Gotham
    closeBtn.Text = "‚úï"
    closeBtn.TextColor3 = Color3.fromRGB(255, 255, 255)
    closeBtn.TextSize = 14

    local closeCorner = Instance.new("UICorner")
    closeCorner.CornerRadius = UDim.new(0, 12)
    closeCorner.Parent = closeBtn

    -- Key System Label
    local keySystemLabel = Instance.new("TextLabel")
    keySystemLabel.Name = "KeySystem"
    keySystemLabel.Parent = mainFrame
    keySystemLabel.BackgroundTransparency = 1
    keySystemLabel.Position = UDim2.new(0, 0, 0, 50)
    keySystemLabel.Size = UDim2.new(0, 200, 0, 50)
    keySystemLabel.Font = Enum.Font.FredokaOne
    keySystemLabel.Text = "KEY SYSTEM"
    keySystemLabel.TextColor3 = Color3.fromRGB(43, 177, 255)
    keySystemLabel.TextSize = 28

    -- Key input container
    local textBoxContainer = Instance.new("Frame")
    textBoxContainer.Name = "TextBoxContainer"
    textBoxContainer.Parent = mainFrame
    textBoxContainer.BackgroundColor3 = Color3.fromRGB(63, 63, 65)
    textBoxContainer.BorderSizePixel = 0
    textBoxContainer.Position = UDim2.new(0.025, 0, 0, 135)
    textBoxContainer.Size = UDim2.new(0, 370, 0, 40)

    local textBoxCorner = Instance.new("UICorner")
    textBoxCorner.CornerRadius = UDim.new(0, 12)
    textBoxCorner.Parent = textBoxContainer

    local textBoxStroke = Instance.new("UIStroke")
    textBoxStroke.Thickness = 3
    textBoxStroke.Color = Color3.fromRGB(255, 255, 255)
    textBoxStroke.Transparency = 0.2
    textBoxStroke.Parent = textBoxContainer

    -- Key input
    keyInput = Instance.new("TextBox")
    keyInput.Name = "KeyTextBox"
    keyInput.Parent = textBoxContainer
    keyInput.BackgroundTransparency = 1
    keyInput.Position = UDim2.new(0.08, 0, 0, 0)
    keyInput.Size = UDim2.new(0, 330, 0, 40)
    keyInput.ZIndex = 2
    keyInput.Font = Enum.Font.SourceSans
    keyInput.PlaceholderColor3 = Color3.fromRGB(220, 220, 220)
    keyInput.PlaceholderText = "Enter your license key..."
    keyInput.Text = ""
    keyInput.TextColor3 = Color3.fromRGB(220, 220, 220)
    keyInput.TextSize = 16
    keyInput.TextXAlignment = Enum.TextXAlignment.Left
    keyInput.TextTruncate = Enum.TextTruncate.AtEnd

    -- Key icon
    local keyIcon = Instance.new("ImageLabel")
    keyIcon.Name = "Kunci"
    keyIcon.Parent = textBoxContainer
    keyIcon.BackgroundTransparency = 1
    keyIcon.Position = UDim2.new(0.02, 0, 0.25, 0)
    keyIcon.Size = UDim2.new(0, 20, 0, 20)
    keyIcon.ZIndex = 3
    keyIcon.Image = "rbxassetid://10723416652"

    -- Status label
    statusLabel = Instance.new("TextLabel")
    statusLabel.Name = "StatusLabel"
    statusLabel.Parent = mainFrame
    statusLabel.BackgroundTransparency = 1
    statusLabel.Position = UDim2.new(0, 0, 0, 185)
    statusLabel.Size = UDim2.new(1, 0, 0, 30)
    statusLabel.Font = Enum.Font.SourceSans
    statusLabel.Text = "Ready to verify key"
    statusLabel.TextColor3 = Color3.fromRGB(180, 180, 180)
    statusLabel.TextSize = 16
    statusLabel.TextXAlignment = Enum.TextXAlignment.Center

    -- Get key button container
    local getKeyContainer = Instance.new("Frame")
    getKeyContainer.Name = "GetKeyContainer"
    getKeyContainer.Parent = mainFrame
    getKeyContainer.BackgroundColor3 = Color3.fromRGB(38, 38, 38)
    getKeyContainer.BorderSizePixel = 0
    getKeyContainer.Position = UDim2.new(0.025, 0, 0, 270)
    getKeyContainer.Size = UDim2.new(0, 163, 0, 40)

    local getKeyCorner = Instance.new("UICorner")
    getKeyCorner.Parent = getKeyContainer

    local getKeyStroke = Instance.new("UIStroke")
    getKeyStroke.Thickness = 2
    getKeyStroke.Color = Color3.fromRGB(255, 165, 0)
    getKeyStroke.Transparency = 0.2
    getKeyStroke.Parent = getKeyContainer

    local getKeyButton = Instance.new("TextButton")
    getKeyButton.Parent = getKeyContainer
    getKeyButton.BackgroundTransparency = 1
    getKeyButton.Size = UDim2.new(1, 0, 1, 0)
    getKeyButton.Font = Enum.Font.SourceSans
    getKeyButton.Text = "üîë Get Key"
    getKeyButton.TextColor3 = Color3.fromRGB(255, 165, 0)
    getKeyButton.TextSize = 16

    -- Submit button container
    local submitContainer = Instance.new("Frame")
    submitContainer.Name = "Submit"
    submitContainer.Parent = mainFrame
    submitContainer.BackgroundColor3 = Color3.fromRGB(38, 38, 38)
    submitContainer.BorderSizePixel = 0
    submitContainer.Position = UDim2.new(0.515, 0, 0, 270)
    submitContainer.Size = UDim2.new(0, 163, 0, 40)

    local submitCorner = Instance.new("UICorner")
    submitCorner.Parent = submitContainer

    local submitStroke = Instance.new("UIStroke")
    submitStroke.Thickness = 3
    submitStroke.Color = Color3.fromRGB(46, 204, 113)
    submitStroke.Transparency = 0.2
    submitStroke.Parent = submitContainer

    local submitButton = Instance.new("TextButton")
    submitButton.Parent = submitContainer
    submitButton.BackgroundTransparency = 1
    submitButton.Size = UDim2.new(1, 0, 1, 0)
    submitButton.Font = Enum.Font.SourceSans
    submitButton.Text = "Submit"
    submitButton.TextColor3 = Color3.fromRGB(46, 204, 113)
    submitButton.TextSize = 20

    -- Discord button container
    local discordContainer = Instance.new("Frame")
    discordContainer.Name = "DiscordContainer"
    discordContainer.Parent = mainFrame
    discordContainer.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
    discordContainer.BorderSizePixel = 0
    discordContainer.Position = UDim2.new(0.125, 0, 0, 330)
    discordContainer.Size = UDim2.new(0, 300, 0, 35)

    local discordCorner = Instance.new("UICorner")
    discordCorner.CornerRadius = UDim.new(0, 8)
    discordCorner.Parent = discordContainer

    local discordButton = Instance.new("TextButton")
    discordButton.Parent = discordContainer
    discordButton.BackgroundTransparency = 1
    discordButton.Size = UDim2.new(1, 0, 1, 0)
    discordButton.Font = Enum.Font.Gotham
    discordButton.Text = "üí¨ JOIN DISCORD"
    discordButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    discordButton.TextSize = 14

    -- Animations
    mainFrame.Size = UDim2.new(0, 0, 0, 0)
    local openTween = TweenService:Create(mainFrame, TweenInfo.new(0.5, Enum.EasingStyle.Back), {
        Size = UDim2.new(0, 400, 0, 450)
    })
    openTween:Play()

    return getKeyButton, submitButton, discordButton, closeBtn
end

-- Validate key with user feedback
local function handleKeyValidation(key)
    updateStatus("üîÑ Verifying key...", Color3.fromRGB(255, 200, 0))
    
    local isValid, message, isPremium = validateKey(key, Identifier, UserID_HWID)
    
    if isValid then
        if isPremium then
            updateStatus("‚úÖ Premium Key! Loading premium script...", Color3.fromRGB(255, 215, 0))
        else
            updateStatus("‚úÖ Success! Loading script...", Color3.fromRGB(0, 255, 100))
        end
        
        -- Save key with premium status
        if writefile then
            pcall(function() 
                local keyData = {
                    key = key,
                    isPremium = isPremium,
                    timestamp = os.time()
                }
                writefile("zzzhub_key.txt", HttpService:JSONEncode(keyData))
            end)
        end
        
        task.wait(1.5)
        
        -- Clean up and load appropriate script
        if screenGui then 
            screenGui:Destroy() 
        end
        
        -- Load premium or regular script based on key type
        local scriptToLoad = isPremium and premiumScriptUrl or regularScriptUrl
        loadstring(game:HttpGet(scriptToLoad))()
    else
        updateStatus("‚ùå " .. message, Color3.fromRGB(255, 100, 100))
    end
end

-- Check for saved key
local function checkSavedKey()
    if isfile and isfile("zzzhub_key.txt") then
        local savedData = readfile("zzzhub_key.txt")
        if savedData and savedData ~= "" then
            -- Try to parse as JSON first (new format)
            local success, keyData = pcall(function()
                return HttpService:JSONDecode(savedData)
            end)
            
            local keyToValidate
            if success and keyData and keyData.key then
                -- New JSON format
                keyToValidate = keyData.key
            else
                -- Old plain text format (fallback)
                keyToValidate = savedData
            end
            
            local isValid, message, isPremium = validateKey(keyToValidate, Identifier, UserID_HWID)
            if isValid then
                -- Load appropriate script based on premium status
                local scriptToLoad = isPremium and premiumScriptUrl or regularScriptUrl
                loadstring(game:HttpGet(scriptToLoad))()
                return true
            else
                -- Key is no longer valid, delete the saved file
                if delfile then
                    pcall(function() delfile("zzzhub_key.txt") end)
                end
            end
        end
    end
    return false
end

-- Main execution
if not checkSavedKey() then
    local getKeyButton, submitButton, discordButton, closeBtn = createUI()
    
    -- Get key button click
    getKeyButton.MouseButton1Click:Connect(function()
        local keyLink = getKeyLink(Identifier, UserID_HWID)
        if copyToClipboard(keyLink) then
            updateStatus("üìã Key link copied to clipboard!", Color3.fromRGB(255, 165, 0))
        else
            updateStatus("üîó Visit: pandadevelopment.net", Color3.fromRGB(255, 165, 0))
        end
    end)
    
    -- Submit button click
    submitButton.MouseButton1Click:Connect(function()
        local key = keyInput.Text:gsub("^%s*(.-)%s*$", "%1") -- Trim whitespace
        if key == "" then
            updateStatus("‚ö†Ô∏è Please enter a key", Color3.fromRGB(241, 196, 15))
            return
        end

        -- Disable button during validation to prevent spam
        submitButton.Text = "Verifying..."
        submitButton.TextColor3 = Color3.fromRGB(100, 100, 100)
        keyInput.TextEditable = false
        
        -- Run validation in a separate thread to avoid blocking UI
        task.spawn(function()
            handleKeyValidation(key)
            
            -- Reset button state
            task.wait(1)
            if submitButton and submitButton.Parent then
                submitButton.Text = "Submit"
                submitButton.TextColor3 = Color3.fromRGB(46, 204, 113)
                keyInput.TextEditable = true
            end
        end)
    end)
    
    -- Enter key press
    keyInput.FocusLost:Connect(function(enterPressed)
        if enterPressed and keyInput.Text ~= "" then
            handleKeyValidation(keyInput.Text)
        end
    end)
    
    -- Discord button
    discordButton.MouseButton1Click:Connect(function()
        if copyToClipboard("https://discord.gg/nRtXqrA8cs") then
            updateStatus("üí¨ Discord invite copied!", Color3.fromRGB(88, 101, 242))
        else
            updateStatus("üí¨ Join our Discord community!", Color3.fromRGB(88, 101, 242))
        end
    end)
    
    -- Close button
    closeBtn.MouseButton1Click:Connect(function()
        if screenGui then
            screenGui:Destroy()
        end
    end)
end
